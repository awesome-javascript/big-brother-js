/**
          _          _            _          _   _          _          _              _            _             _
        /\ \       /\ \         /\ \       /\_\/\_\ _     /\ \       /\ \           /\ \         /\ \     _    /\ \
       /  \ \     /  \ \       /  \ \     / / / / //\_\   \ \ \     /  \ \         /  \ \       /  \ \   /\_\ /  \ \
      / /\ \ \   / /\ \ \     / /\ \ \   /\ \/ \ \/ / /   /\ \_\   / /\ \_\       / /\ \ \     / /\ \ \_/ / // /\ \ \
     / / /\ \_\ / / /\ \ \   / / /\ \_\ /  \____\__/ /   / /\/_/  / / /\/_/      / / /\ \ \   / / /\ \___/ // / /\ \_\
    / /_/_ \/_// / /  \ \_\ / / /_/ / // /\/________/   / / /    / / / ______   / / /  \ \_\ / / /  \/____// /_/_ \/_/
   / /____/\  / / /   / / // / /__\/ // / /\/_// / /   / / /    / / / /\_____\ / / /   / / // / /    / / // /____/\
  / /\____\/ / / /   / / // / /_____// / /    / / /   / / /    / / /  \/____ // / /   / / // / /    / / // /\____\/
 / / /      / / /___/ / // / /\ \ \ / / /    / / /___/ / /__  / / /_____/ / // / /___/ / // / /    / / // / /______
/ / /      / / /____\/ // / /  \ \ \\/_/    / / //\__\/_/___\/ / /______\/ // / /____\/ // / /    / / // / /_______\
\/_/       \/_________/ \/_/    \_\/        \/_/ \/_________/\/___________/ \/_________/ \/_/     \/_/ \/__________/

 #BigBrotherJS - http://www.bigbrotherjs.com

 Copyright (c) 2014 Formigone.
 @author Rodrigo Silveira. http://www.rodrigo-silveira.com
*/

BB.Frame=function(a,b,c,d){this.win=a;this.scroll=b;this.mouse=c;this.clicked=d||!1};BB.Frame.getClientRes=function(){return{width:window.innerWidth,height:window.innerHeight}};BB.Frame.getCurrentWin=function(){return{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}};BB.Frame.getCurrentScroll=function(){return{offsetX:document.body.scrollLeft,offsetY:document.body.scrollTop}};
BB.Frame.getCurrentMouse=function(){return{x:BB.Session.mouse.x||0,y:BB.Session.mouse.y||0}};BB.Recording=function(a,b,c,d,e){this.title=a;this.url=b;this.res=c;this.fps=d;this.frames=e};
BB.RecPlayer=function(a){this.recording=a||{};this.win=document.createElement("div");this.viewport=document.createElement("div");this.doc=document.createElement("iframe");this.mouse=document.createElement("img");this.ticks={FRAME_DUR_MILLI:0,FRAME_DUR_SEC:0};this.frames={TOTAL:0,CURRENT:0};this.active=!1;this._mouseOn=new Image;this._mouseOff=new Image;this.init()};
BB.RecPlayer.prototype.init=function(){this._mouseOn.src="/img/mouse-on.png";this._mouseOff.src="/img/mouse-off.png";this.win.className="bb-win";this.viewport.className="bb-vp";this.doc.className="bb-doc";this.mouse.className="bb-mouse";this.mouse._width=32;this.mouse._height=32;this.mouse._centerX=parseInt(0.5*this.mouse._width);this.mouse._centerY=parseInt(0.5*this.mouse._height);this.mouse.style.left="-100px";this.mouse.style.top="-100px";this.mouse.src=this._mouseOff.src;this.win.appendChild(this.mouse);
this.win.appendChild(this.viewport);this.viewport.appendChild(this.doc)};BB.RecPlayer.prototype.setRecording=function(a){this.recording=a;this.active=!1};BB.RecPlayer.prototype.centerMouse=function(a,b){this.mouse.style.left=a-this.mouse._centerX+"px";this.mouse.style.top=b-this.mouse._centerY+"px"};
BB.RecPlayer.prototype.tick=function(){var a=this.recording.frames[this.frames.CURRENT];this.centerMouse(a.mouse.x,a.mouse.y);this.mouse.src=a.clicked?this._mouseOn.src:this._mouseOff.src;this.frames.CURRENT++;this.frames.CURRENT<this.frames.TOTAL&&setTimeout(this.tick.bind(this),this.ticks.FRAME_DUR_MILLI)};
BB.RecPlayer.prototype.go=function(a){if(!this.active&&this.recording!=={}){for(var b;a.firstChild;)b=a.firstChild.cloneNode(!0),a.replaceChild(b);this.ticks.FRAME_DUR_MILLI=1E3/this.recording.fps;this.ticks.FRAME_DUR_SEC=this.recording.fps/1E3;this.frames.TOTAL=this.recording.frames.length;this.frames.CURRENT=0;this.win.style.width=this.recording.res.width+"px";this.win.style.height=this.recording.res.height+"px";this.viewport.style.width=this.recording.frames[0].win.width+"px";this.viewport.style.height=
this.recording.frames[0].win.height+"px";this.doc.style.width=this.recording.frames[0].win.width+"px";this.doc.style.height=this.recording.frames[0].win.height+"px";this.doc.src=this.recording.url;this.mouse.style.transitionDuration=this.ticks.FRAME_DUR_SEC+"s";this.centerMouse(this.recording.frames[0].mouse.x,this.recording.frames[0].mouse.y);a.appendChild(this.win);this.active=!0;this.tick()}};
BB.Session=function(a,b,c,d){this.backendUrl=a;this.fps=b||3;this.TICK_MILLI=1E3/this.fps;this.title=c||BB.Session.getPageTitle();this.url=d||BB.Session.getPageUrl();this.frames=[];this.clicked=this.active=!1;this.init()};BB.Session.prototype.init=function(){var a=this;document.addEventListener("mousemove",function(a){BB.Session.mouse.x=a.clientX||a.pageX;BB.Session.mouse.y=a.clientY||a.pageY},!1);document.addEventListener("click",function(b){a.clicked=!0},!1)};
BB.Session.prototype.start=function(){this.active||(this.active=!0,this.tick())};BB.Session.prototype.stop=function(){clearTimeout(this.timer);this.active=!1};BB.Session.prototype.tick=function(){if(this.active){var a=new BB.Frame(BB.Frame.getCurrentWin(),BB.Frame.getCurrentScroll(),BB.Frame.getCurrentMouse(),this.clicked);this.frames.push(a);this.timer=setTimeout(this.tick.bind(this),this.TICK_MILLI);this.clicked=!1}};
BB.Session.prototype.upload=function(){var a=new XMLHttpRequest;a.open("POST","/save.php",!0);a.setRequestHeader("Content-type","application/x-www-form-urlencoded");a.send("recording="+this.toString())};BB.Session.getPageTitle=function(){var a=document.getElementsByTagName("title"),b="Untitled document";0<a.length&&(b=a[0].textContent);return b};BB.Session.getPageUrl=function(){return window.location.href};
BB.Session.prototype.toString=function(){return JSON.stringify(new BB.Recording(this.title,this.url,BB.Frame.getClientRes(),this.fps,this.frames))};BB.Session.mouse={x:0,y:0};
//# sourceMappingURL=bb.js.map
